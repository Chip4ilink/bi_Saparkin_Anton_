{"version":3,"file":"index.js","mappings":"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","sources":["webpack://calendar/./node_modules/mdt-client/dist/index.js","webpack://calendar/./src/navigation.ts","webpack://calendar/./src/form.ts","webpack://calendar/webpack/bootstrap","webpack://calendar/./src/index.ts"],"sourcesContent":["\"use strict\";\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.registerModule = exports.legacy = exports.modules = exports.App = exports.Schema = exports.UiComponents = exports.ModuleRegistry = exports.RecordManager = exports.CommandManager = exports.Page = exports.Auth = exports.Filter = exports.m = exports.Api = exports.Ui = exports.Utils = exports.mUtils = exports.FieldControl = exports.ControlManager = exports.Form = exports.FormService = exports.List = exports.ListService = exports.SecurityManager = exports.Navigation = exports.MDT = void 0;\r\nvar package_json_1 = __importDefault(require(\"../package.json\"));\r\nexports.MDT = window.MDT;\r\nexports.Navigation = exports.MDT.Navigation, exports.SecurityManager = exports.MDT.SecurityManager, exports.ListService = exports.MDT.ListService, exports.List = exports.MDT.List, exports.FormService = exports.MDT.FormService, exports.Form = exports.MDT.Form, exports.ControlManager = exports.MDT.ControlManager, exports.FieldControl = exports.MDT.FieldControl, exports.mUtils = exports.MDT.mUtils, exports.Utils = exports.MDT.Utils, exports.Ui = exports.MDT.Ui, exports.Api = exports.MDT.Api, exports.m = exports.MDT.m, exports.Filter = exports.MDT.Filter, exports.Auth = exports.MDT.Auth, exports.Page = exports.MDT.Page, exports.CommandManager = exports.MDT.CommandManager, exports.RecordManager = exports.MDT.RecordManager, exports.ModuleRegistry = exports.MDT.ModuleRegistry, exports.UiComponents = exports.MDT.UiComponents, exports.Schema = exports.MDT.Schema, exports.App = exports.MDT.App, exports.modules = exports.MDT.modules, exports.legacy = exports.MDT.legacy;\r\nfunction registerModule(callback, context) {\r\n    exports.MDT.registerModule(callback, {\r\n        version: package_json_1.default.version,\r\n        name: context === null || context === void 0 ? void 0 : context.name\r\n    });\r\n}\r\nexports.registerModule = registerModule;\r\n//# sourceMappingURL=index.js.map","import {\n    Navigation, SecurityManager\n}\n    from \"mdt-client\";\n\nexport function prepareNavigation() {\n    if (!SecurityManager.getUser().isAdmin) return;\n    Navigation.addNode({\n            title: \"calendar:Calendar\",\n            code: \"calendar\",\n            icon: \"calendar\",\n            parentPath: \"adm/modules\",\n            controlCode: \"dashboard\",\n            controlTemplate: {\n                \"code\": \"calendar.SyncControlPanel\"          \n            },\n            childNodes: [\n                {\n                    code: \"years\",\n                    title: null,\n                    objectCode: \"calendar.Year\"\n                },\n                {\n                    code: \"halfyears\",\n                    title: null,\n                    objectCode: \"calendar.HalfYear\"\n                },\n                {\n                    code: \"quarters\",\n                    title: null,\n                    objectCode: \"calendar.Quarter\"\n                },\n                {\n                    code: \"months\",\n                    title: null,\n                    objectCode: \"calendar.Month\"\n                },\n                {\n                    code: \"weeks\",\n                    title: null,\n                    objectCode: \"calendar.Week\"\n                },\n                {\n                    code: \"dates\",\n                    title: null,\n                    objectCode: \"calendar.Date\"\n                },\n                {\n                    code: \"specialdatesbycountry\",\n                    title: null,\n                    objectCode: \"calendar.SpecialDateByCountry\"\n                },\n                {\n                    code: \"specialdatetypes\",\n                    title: null,\n                    objectCode: \"calendar.SpecialDateType\"\n                },\n                {\n                    code: \"periods\",\n                    title: null,\n                    objectCode: \"calendar.Period\"\n                },\n                {\n                    code: \"periodtypes\",\n                    title: null,\n                    objectCode: \"calendar.PeriodType\"\n                }\n            ]\n        });\n}","import { Api, Ui, FormService } from \"mdt-client\";\n\nexport function customizeForm(){\n    FormService.onCreated(form => {\n        if (form.getObject().getCode() != \"calendar.SyncControlPanel\") return;\n\n        form.addCommand({\n            title: \"Включить синхронизацию\",\n            type: \"primary\",\n            execute: () => {\n                Api.fetchRecord(\"job.Task\", {\n                    top: 1,\n                    filter: {\n                        op: \"eq\",\n                        p1: \"Code\",\n                        p2: \"calendar.sync\"\n                    }\n                }).then((taskRecord) => {\n                    if (!taskRecord)\n                        return;\n                    if (taskRecord[\"FlagActive\"] == true){\n                        Ui.showNotification(\n\t\t\t\t        \t{\n\t\t\t\t        \t\ttitle: \"Синхронизация уже включена\",\n                                text: null\n\t\t\t\t        \t},\n\t\t\t\t        \t5000\n\t\t\t\t        );\n                        return;\n                    }\n                    Api.fetchRecord(\"job.History\", {\n                        top: 1,\n                        filter: {\n                            op: \"eq\",\n                            p1: \"ID_Task\",\n                            p2: taskRecord[\"ID\"]\n                        }\n                    }).then;\n                    Api.save(\"job.Task\", {\n                        ID: taskRecord[\"ID\"],\n                        FlagActive: true\n                    });\n                    Ui.showNotification(\n                            {\n                                title: \"Синхронизация включена\",\n                                text: `Включена служба ${taskRecord[\"Code\"]}`\n                            },\n                            5000\n                        );     \n                });                                   \n            }\n        });\n\n        form.addCommand({\n            title: \"Приостановить синхронизацию\",\n            type: \"fatal\",\n            execute: () => {\n                Api.fetchRecord(\"job.Task\", {\n                    top: 1,\n                    filter: {\n                        op: \"eq\",\n                        p1: \"Code\",\n                        p2: \"calendar.sync\"\n                    }}).then((taskRecord) => {\n                        if (!taskRecord)\n                            return;\n                        if (taskRecord[\"FlagActive\"] == false){\n                            Ui.showNotification(\n\t\t\t\t            \t{\n\t\t\t\t            \t\ttitle: \"Синхронизация уже приостановлена\",\n                                    text: null\n\t\t\t\t            \t},\n\t\t\t\t            \t5000\n\t\t\t\t            );\n                            return;\n                        }\n                        Api.save(\"job.Task\", {\n                            ID: taskRecord[\"ID\"],\n                            FlagActive: false\n                        });\n                        Ui.showNotification(\n                                {\n                                    title: \"Синхронизация приостановлена\",\n                                    text: `Выключена служба ${taskRecord[\"Code\"]}`\n                                },\n                                5000\n                            );     \n                    });                                   \n            }\n        });\n\n        form.addCommand({\n            title: \"Выполнить синхронизацию немедленно\",\n            type: \"primary\",\n            execute: () => {\n                Ui.showNotification(\n                    {\n                        title: \"Процесс синхронизация запущен\",\n                        text: `Происходит выполнение службы calendar.sync`\n                    },\n                    5000\n                ); \n                Api.request(\"job/ExecTask?taskcode=calendar.sync\", {}, {\n                    method: \"POST\"\n                }).then(() => {\n                    Ui.showNotification(\n                        {\n                            title: \"Процесс синхронизация завершен\",\n                            text: `Завершено выполнение службы calendar.sync`\n                        },\n                        5000\n                    ); \n                });\n            }\n        });\n    });\n}","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","import { prepareNavigation } from \"./navigation\";\nimport { registerModule } from \"mdt-client\";\nimport { customizeForm } from \"form\";\n\n\nregisterModule(() => {\n    prepareNavigation();\n    customizeForm();\n}, { name: \"calendar-client\" }); "],"names":["__importDefault","this","mod","__esModule","Object","defineProperty","exports","value","registerModule","legacy","modules","App","Schema","UiComponents","ModuleRegistry","RecordManager","CommandManager","Page","Auth","Filter","m","Api","Ui","Utils","mUtils","FieldControl","ControlManager","Form","FormService","List","ListService","SecurityManager","Navigation","MDT","package_json_1","window","callback","context","version","default","name","getUser","isAdmin","addNode","title","code","icon","parentPath","controlCode","controlTemplate","childNodes","objectCode","onCreated","form","getObject","getCode","addCommand","type","execute","fetchRecord","top","filter","op","p1","p2","then","taskRecord","save","ID","FlagActive","showNotification","text","request","method","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","call","prepareNavigation","customizeForm"],"sourceRoot":""}