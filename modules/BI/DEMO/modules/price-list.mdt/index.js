(()=>{"use strict";var e={12:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteDiscount=t.deactivateDiscount=void 0;const o=i(468),s=i(913),c=i(305);t.deactivateDiscount=function(e,t){o.DeactivationService.Deactivate({updateMdtObjectCode:s.DbSchema.DiscountListView,updateDateEndField:"DateEnd",dateBeginField:"DateBegin",dateEndField:"DateEnd",primaryFieldFromObjectRow:"ID",objectRows:t,dateEndNotValidMessage:"pl:DiscountDeactivateDateConf",formTitle:"pl:DiscountDeactivateFormTitle",buttonTitle:"pl:DeactivateDiscount",allAlreadyDeactivatedMessage:"pl:DiscountDeactivatedAll",nextRecordsWillBeDeactivatedMessage:"pl:DiscountDeactivateNext",someAlreadyDeactivatedMessage:"pl:DiscountDeactivatedSome",onDeactivated(){e.refresh().then(()=>c.Ui.showNotification({type:"success",title:"serverMessageType:Success",text:"pl:DiscountDeactivated"},3e3))}})},t.deleteDiscount=function(e,t){o.DeactivationService.DeleteDiscount({updateMdtObjectCode:s.DbSchema.DiscountListView,primaryFieldFromObjectRow:"ID",objectRows:t,formTitle:"pl:DiscountDeleteFormTitle",buttonTitle:s.Translation.Discount.Delete,buttonIcon:"trash",nextRecordsWillBeDeletedMessage:"pl:DiscountDeleteNext",onDeleted(){e.getListCtrl().exts.select.clear(),e.refresh().then(()=>c.Ui.showNotification({type:"success",title:"serverMessageType:Success",text:"pl:DiscountDeleted"},3e3))}})}},60:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFormListItem=t.CustomFormTextItem=t.CustomFormFieldItem=t.CustomFormItem=void 0;const o=i(305);class s{}t.CustomFormItem=s,t.CustomFormFieldItem=class extends s{constructor(e,t){super(),this.code=e,this.title=t}getLayoutCol(){return{type:"field",options:{field:this.code,title:this.title}}}},t.CustomFormTextItem=class extends s{constructor(e){super(),this.text=e}getLayoutCol(){var e;return{width:12,options:{content:null!==(e=o.Utils.getText(this.text))&&void 0!==e?e:this.text},type:"markdown"}}},t.CustomFormListItem=class extends s{constructor(e,t){super(),this.objectCode=e,this.objectIds=t}getLayoutCol(){return{width:12,type:"list",options:{tableCode:this.objectCode,extConfig:{toolbar:!1,form:!1,select:!1,merge:!1},filter$:{$:"filter",filter:{op:"in",p1:"ID",p2:this.objectIds}},hideTitle:!0}}}}},156:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.discountSkuHierarchy=void 0;const o=i(305),s=i(262),c=i(724),n=i(379),r=i(678),a=i(748),l=i(832);t.discountSkuHierarchy={levels:[]},(0,o.registerModule)(()=>{o.SecurityManager.getUser().isAnonymous||o.Api.request("PriceList/GetSkuHierarchySettings").then(e=>{e.forEach(e=>{var i,s,c,n;t.discountSkuHierarchy.levels.push({Object:o.Schema.getObject(e.skuObjectLevel,!0),o2mField:null===(i=o.Schema.getObject("pl.Discount",!0))||void 0===i?void 0:i.getField(e.discountO2MField),id:e.id,o2mObjectSkuRef:null===(s=o.Schema.getObject(e.o2mTable,!0))||void 0===s?void 0:s.getField(e.o2mObjectSkuRef),o2mObject:o.Schema.getObject(e.o2mTable,!0),splittedDiscountObjectSkuRef:e.splittedDiscountObjectSkuRef?null===(c=o.Schema.getObject("pl.vw_SplitDiscounts",!0))||void 0===c?void 0:c.getField(e.splittedDiscountObjectSkuRef):null,o2mDiscountRef:null===(n=o.Schema.getObject(e.o2mTable,!0))||void 0===n?void 0:n.getField(e.o2mDiscountRef)})})})},{name:"price-list"}),o.ListService.onCreate(e=>{s.PriceListListExtender.init(e),r.DiscountListExtender.init(e),l.CommonListExtender.init(e)}),o.FormService.onCreate(e=>{c.PriceListFormExtender.init(e),a.DiscountFormExtender.init(e)}),(0,n.initCommands)()},256:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAddDiscountCommand=void 0;const o=i(913),s=i(305);t.getAddDiscountCommand=function(e){return{title:o.Translation.Discount.Add,code:o.Translation.Discount.Add,icon:"plus",execute(t){const i=s.FormService.create(o.DbSchema.Discount,0),c=null==t?void 0:t.list;s.Ui.showSidebar(i),i.onClose(()=>{null!=e&&e(),null!=c&&c.refresh()})}}}},262:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PriceListListExtender=void 0;const o=i(913),s=i(686),c=i(305),n=i(276);class r{static haveAccess(e){return this.sm.hasPermission(this.schemaObject,e)}static init(e){var t,i;if(e.getObject().getCode()!=o.DbSchema.PriceListView)return;e.getListCtrl().events.query.push(e=>{e.disableDefaultSorting=!0});const r=(0,s.getAddPriceCommand)(()=>{e.refresh()}),a=!!(null===(i=null===(t=e.getListCtrl())||void 0===t?void 0:t.options)||void 0===i?void 0:i.readonly);e.addCommand({code:"pricelist.addPrice",title:r.title,icon:r.icon,execute:()=>r.execute(null),visible:()=>!a&&this.haveAccess(c.SecurityManager.PermissionLevel.Add)});const l=(0,s.getAddFilePriceCommand)(()=>{e.refresh()});let d=()=>l.execute(null);this.ListAddCommand(e,l.title,l.icon,o.Translation.Price.LoadFileDescription,d,!0,"pricelist.loadPriceFile",()=>!a&&this.haveAccess(c.SecurityManager.PermissionLevel.Add)),d=()=>(0,n.deactivatePriceList)(e,e.getSelectedRows()),this.ListAddCommand(e,o.Translation.Price.Delist,"cart-xmark",o.Translation.Price.DelistDescription,d,!1,"pricelist.delisting",()=>!a&&this.haveAccess(c.SecurityManager.PermissionLevel.Write)),Boolean(e.getListCtrl().extConfig.toolbar)&&c.legacy.utils.combine(e.getListCtrl().extConfig,{toolbar:{more:[{code:"pricelist.delelePrice",title:o.Translation.Price.Delete,icon:"xmark",command:()=>(0,n.deletePriceList)(e,e.getSelectedRows()),class:"link-danger",type:"danger",visible:()=>e.getSelectedRows().length>0&&this.haveAccess(c.SecurityManager.PermissionLevel.Delete)}]}})}static ListAddCommand(e,t,i,o,s,n,r,a){const l=()=>e.getSelectedRows().length>0||n;e.addCommand({code:r,title:t,execute:s,enabled:l,description:()=>l()?o:c.Utils.getText(o)+". "+c.Utils.getText("Pick records"),icon:i,visible:a})}}t.PriceListListExtender=r,r.schemaObject=c.Schema.getObject(o.DbSchema.PriceList,!0),r.sm=c.SecurityManager},276:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deletePriceList=t.deactivatePriceList=void 0;const o=i(468),s=i(913),c=i(305);t.deactivatePriceList=function(e,t){o.DeactivationService.Deactivate({updateMdtObjectCode:s.DbSchema.PriceList,updateDateEndField:"DateEnd",dateBeginField:"SrcDateBegin",dateEndField:"SrcDateEnd",primaryFieldFromObjectRow:"SrcId/ID",objectRows:t,dateEndNotValidMessage:"pl:PriceDeactivateDateConf",formTitle:"pl:PriceDeactivateFormTitle",buttonTitle:s.Translation.Price.Delist,buttonIcon:"cart-xmark",allAlreadyDeactivatedMessage:"pl:PriceDeactivatedAll",nextRecordsWillBeDeactivatedMessage:"pl:PriceDeactivateNext",someAlreadyDeactivatedMessage:"pl:PriceDeactivatedSome",onDeactivated(){e.refresh().then(()=>c.Ui.showNotification({type:"success",title:"serverMessageType:Success",text:"pl:PriceDeactivated"},3e3))}})},t.deletePriceList=function(e,t){o.DeactivationService.DeletePriceList({updateMdtObjectCode:s.DbSchema.PriceList,primaryFieldFromObjectRow:"SrcId/ID",objectRows:t,formTitle:"pl:PriceDeleteFormTitle",buttonTitle:s.Translation.Price.Delete,buttonIcon:"trash",nextRecordsWillBeDeletedMessage:"pl:PriceDeleteNext",onDeleted(){e.getListCtrl().exts.select.clear(),e.refresh().then(()=>c.Ui.showNotification({type:"success",title:"serverMessageType:Success",text:"pl:PriceDeleted"},3e3))}})}},305:function(e,t,i){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.registerModule=t.legacy=t.modules=t.App=t.Schema=t.UiComponents=t.ModuleRegistry=t.RecordManager=t.CommandManager=t.Page=t.Auth=t.Filter=t.m=t.Api=t.Ui=t.Utils=t.mUtils=t.FieldControl=t.ControlManager=t.FormDashboard=t.Form=t.FormService=t.List=t.ListService=t.SecurityManager=t.Navigation=t.MDT=void 0;var s=o(i(523));t.MDT=window.MDT,t.Navigation=t.MDT.Navigation,t.SecurityManager=t.MDT.SecurityManager,t.ListService=t.MDT.ListService,t.List=t.MDT.List,t.FormService=t.MDT.FormService,t.Form=t.MDT.Form,t.FormDashboard=t.MDT.FormDashboard,t.ControlManager=t.MDT.ControlManager,t.FieldControl=t.MDT.FieldControl,t.mUtils=t.MDT.mUtils,t.Utils=t.MDT.Utils,t.Ui=t.MDT.Ui,t.Api=t.MDT.Api,t.m=t.MDT.m,t.Filter=t.MDT.Filter,t.Auth=t.MDT.Auth,t.Page=t.MDT.Page,t.CommandManager=t.MDT.CommandManager,t.RecordManager=t.MDT.RecordManager,t.ModuleRegistry=t.MDT.ModuleRegistry,t.UiComponents=t.MDT.UiComponents,t.Schema=t.MDT.Schema,t.App=t.MDT.App,t.modules=t.MDT.modules,t.legacy=t.MDT.legacy,t.registerModule=function(e,i){t.MDT.registerModule(e,{version:s.default.version,name:null==i?void 0:i.name})}},379:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initCommands=void 0;const o=i(305),s=i(686),c=i(913),n=i(256),r=i(913);t.initCommands=function(){const e=o.CommandManager.addGroup({code:"PriceList",title:c.Translation.Common.PriceList,icon:"money-check-dollar-pen"}),t={[r.DbSchema.PriceList]:{commands:[(0,s.getAddPriceCommand)(),(0,s.getAddFilePriceCommand)()]},[r.DbSchema.Discount]:{commands:[(0,n.getAddDiscountCommand)()]}};Object.entries(t).forEach(([t,{commands:i}])=>{const s=o.Schema.getObject(t,!0);s&&o.SecurityManager.hasPermission(s,o.SecurityManager.PermissionLevel.Add)&&e.addCommands(i)})}},468:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(s,c){function n(e){try{a(o.next(e))}catch(e){c(e)}}function r(e){try{a(o.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,r)}a((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.DeactivationService=void 0;const s=i(305),c=i(685),n=i(60),r=i(913),a=i(156);t.DeactivationService=class{static GetFieldValue(e,t){var i,o;return t.includes("/")?t.split("/").reduce((e,t)=>null==e?void 0:e[t],e):null!==(o=null===(i=e[t])||void 0===i?void 0:i.ID)&&void 0!==o?o:e[t]}static Deactivate(e){let t=new Date(1970,0,1);const i=[],o=[];e.objectRows.forEach(s=>{t<s[e.dateBeginField]&&(t=s[e.dateBeginField]);const c=s[e.dateEndField];null==c||c.toDateString()===r.systemDateEnd.toDateString()?o.push(s):i.push(s)}),0!==o.length?this.showDeactivationForm(e,t,o,i.length>0):this.showInformationForm(e.allAlreadyDeactivatedMessage)}static showDeactivationForm(e,t,i,a){var l;const d=()=>{const e=m.value("DateEnd");if(e)return e.setHours(0,0,0,0),t.setHours(0,0,0,0),e>=t},u=[];a&&u.push(new n.CustomFormTextItem(e.someAlreadyDeactivatedMessage)),u.push(new n.CustomFormTextItem(e.nextRecordsWillBeDeactivatedMessage)),u.push(new n.CustomFormListItem(e.updateMdtObjectCode,i.map(t=>this.GetFieldValue(t,e.primaryFieldFromObjectRow))));const m=c.CustomFormService.Create({title:e.formTitle,fields:[{title:s.Utils.getText("Date end"),code:"DateEnd",type:"date",validate:()=>{var t;return d()?null:null!==(t=s.Utils.getText(e.dateEndNotValidMessage))&&void 0!==t?t:e.dateEndNotValidMessage}}],items:u,btn:{title:e.buttonTitle,icon:null!==(l=e.buttonIcon)&&void 0!==l?l:"power-off",enabled:d},onSave:t=>o(this,void 0,void 0,function*(){const o=t.DateEnd,c=e.updateMdtObjectCode==r.DbSchema.DiscountListView?r.DbSchema.Discount:e.updateMdtObjectCode,n=e.updateMdtObjectCode==r.DbSchema.DiscountListView?"ID_Discount":e.primaryFieldFromObjectRow,a=i.filter(t=>e.updateMdtObjectCode==r.DbSchema.DiscountListView&&Boolean(t.ID_md_SkuHierarchySettings)),l=i.filter(t=>e.updateMdtObjectCode==r.DbSchema.DiscountListView&&!Boolean(t.ID_md_SkuHierarchySettings)||e.updateMdtObjectCode==r.DbSchema.PriceList);if(a.length>0){const e=this.getDeactivatableDiscounts(a);yield this.saveDeactivatableDiscount(e,o)}if(l.length>0)for(const e of l){const t=yield s.Api.fetchRecord(c,{filter:s.Filter.eq("Id",this.GetFieldValue(e,n))});t.DateEnd=o,yield s.Api.save(c,t,{messageAction:{action:{code:"pl:Confirmed",value:1}}})}e.onDeactivated(i)})});s.Ui.showSidebar(m)}static showInformationForm(e){const t=c.CustomFormService.Create({title:"serverMessageType:Information",items:[new n.CustomFormTextItem(e)],btn:{visible:()=>!1}});s.Ui.showModal(t,{type:"primary"})}static getDeactivatableDiscounts(e){let t=new Map;return e.forEach(e=>{const i=e.ID_Discount,o=a.discountSkuHierarchy.levels.find(t=>t.id==e.ID_md_SkuHierarchySettings);t.has(i)||t.set(i,{ID:i,Record:e,skuHierarchy:o,Childs:[]});const s={idSkuObject:e[o.splittedDiscountObjectSkuRef.getCode()].ID,id:e.ID_Discount_O2M,idDiscount:i};t.get(i).Childs.push(s)}),Array.from(t.values())}static saveDeactivatableDiscount(e,t){var i;return o(this,void 0,void 0,function*(){for(const c of e){const e=c.Record,n=c.Childs,r=(yield s.Api.fetch("pl.Discount",{filter:s.Filter.eq("ID",c.ID)})).records.pop();let a=[];if(r){const e=yield s.Api.fetch(c.skuHierarchy.o2mObject.getCode(),{filter:s.Filter.eq(c.skuHierarchy.o2mDiscountRef.getCode(),r.ID)});a=null!==(i=null==e?void 0:e.records.map(e=>({id:e.ID,idDiscount:e.ID_Discount,idSkuObject:e[c.skuHierarchy.o2mObjectSkuRef.getCode()]})))&&void 0!==i?i:[]}let l={DateBegin:e.DateBegin,DateEnd:t,ID_PriceListType:e.ID_PriceListType,ID_geo_Country:e.ID_geo_Country,ID_DiscountType:e.ID_DiscountType,ID_md_Company:e.ID_md_Company,DiscountAmount:e.DiscountAmount,ID_md_SkuHierarchySettings:e.ID_md_SkuHierarchySettings};var o=c.skuHierarchy.o2mField.getCode();l[o]=[],n.forEach(e=>{var t={$fk:c.skuHierarchy.o2mDiscountRef.getCode(),$table:c.skuHierarchy.o2mObject.getCode()};t[c.skuHierarchy.o2mObjectSkuRef.getCode()]=e.idSkuObject,l[o].push(t)}),yield s.Api.save("pl.Discount",l,{messageAction:{action:{code:"pl:Confirmed",value:1}}})}})}static DeletePriceList(e){var t;const i=[new n.CustomFormTextItem(e.nextRecordsWillBeDeletedMessage),new n.CustomFormListItem(e.updateMdtObjectCode,e.objectRows.map(t=>this.GetFieldValue(t,e.primaryFieldFromObjectRow)))],r=c.CustomFormService.Create({title:e.formTitle,items:i,btn:{title:e.buttonTitle,icon:null!==(t=e.buttonIcon)&&void 0!==t?t:"trash",type:"danger"},onSave:t=>o(this,void 0,void 0,function*(){yield this.deleteRecords(e.updateMdtObjectCode,e.objectRows,e.primaryFieldFromObjectRow),e.onDeleted(e.objectRows)})});s.Ui.showModal(r,{type:"danger"})}static DeleteDiscount(e){var t;const i=e.objectRows.filter(e=>Boolean(e.ID_md_SkuHierarchySettings)),a=e.objectRows.filter(e=>!Boolean(e.ID_md_SkuHierarchySettings)),l=this.getDeactivatableDiscounts(i),d=[new n.CustomFormTextItem(e.nextRecordsWillBeDeletedMessage),new n.CustomFormListItem(e.updateMdtObjectCode,e.objectRows.map(t=>this.GetFieldValue(t,e.primaryFieldFromObjectRow)))],u=c.CustomFormService.Create({title:e.formTitle,items:d,btn:{title:e.buttonTitle,icon:null!==(t=e.buttonIcon)&&void 0!==t?t:"trash",type:"danger"},onSave:t=>o(this,void 0,void 0,function*(){const t=l.map(e=>({object:e.skuHierarchy.o2mObject.getCode(),discountId:e.ID,ids:e.Childs.map(e=>e.id)}));for(const e of t)yield this.deleteRecords(e.object,e.ids.map(e=>({ID:e})),"ID");for(const e of t)0==(yield s.Api.fetch(e.object,{filter:s.Filter.eq("ID_Discount",e.discountId)})).records.length&&(yield this.deleteRecords(r.DbSchema.Discount,[{ID:e.discountId}],"ID"));yield this.deleteRecords(r.DbSchema.Discount,a,"ID_Discount"),e.onDeleted(e.objectRows)})});s.Ui.showModal(u,{type:"danger"})}static deleteRecords(e,t,i){return o(this,void 0,void 0,function*(){const o=t.map(e=>this.GetFieldValue(e,i));for(const t of o)yield s.Api.save(e,{ID:t,$destroy:!0},{messageAction:{actions:[{code:"DmFlagConfirm",value:"true"}]}})})}}},523:e=>{e.exports=JSON.parse('{"name":"mdt-client","version":"31.3.20","description":"","main":"dist/index.js","types":"dist/index.d.ts","files":["/dist","/types"],"scripts":{"build":"tsc","types-update":"tsc --project tsconfig.facade-types.json","update":"tsc --project tsconfig.facade-types.json && tsc","pub-patch":"npm version patch && npm publish"},"repository":{"type":"git","url":"git@gitlab.ics-it.ru:mdtc/mdt-facade.git"},"author":"","license":"ISC","devDependencies":{"typescript":"^4.8.4"},"dependencies":{"@types/mithril":"^0.0.27"}}')},678:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiscountListExtender=void 0;const o=i(913),s=i(256),c=i(305),n=i(12);class r{static haveAccess(e){return this.sm.hasPermission(this.schemaObject,e)}static init(e){var t,i,r=e.getObject().getCode();if(r!=o.DbSchema.PriceListView&&r!=o.DbSchema.DiscountListView)return;const a=(0,s.getAddDiscountCommand)(()=>{e.refresh()}),l=!!(null===(i=null===(t=e.getListCtrl())||void 0===t?void 0:t.options)||void 0===i?void 0:i.readonly);if(e.addCommand({code:"pricelist.addDiscount",title:a.title,icon:a.icon,execute:()=>a.execute(null),visible:()=>!l&&this.haveAccess(c.SecurityManager.PermissionLevel.Add)}),r===o.DbSchema.DiscountListView){const t=()=>e.getSelectedRows().length>0;e.addCommand({code:"pricelist.deactivateDiscount",title:o.Translation.Discount.Deactivate,execute:()=>(0,n.deactivateDiscount)(e,e.getSelectedRows()),enabled:t,description:()=>t()?null:"Pick records",icon:"power-off",visible:()=>!l&&this.haveAccess(c.SecurityManager.PermissionLevel.Write)}),Boolean(e.getListCtrl().extConfig.toolbar)&&c.legacy.utils.combine(e.getListCtrl().extConfig,{toolbar:{more:[{code:"discount.delelePrice",title:o.Translation.Discount.Delete,icon:"xmark",command:()=>(0,n.deleteDiscount)(e,e.getSelectedRows()),class:"link-danger",type:"danger",visible:()=>e.getSelectedRows().length>0&&this.haveAccess(c.SecurityManager.PermissionLevel.Delete)}]}})}}}t.DiscountListExtender=r,r.schemaObject=c.Schema.getObject(o.DbSchema.Discount,!0),r.sm=c.SecurityManager},685:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CustomFormService=void 0;const o=i(60),s=i(305);t.CustomFormService=class{static Create(e){var t,i;const c=[],n=[];return c.push({code:"CustomField",type:"number",nullable:!0}),null===(t=e.fields)||void 0===t||t.forEach(e=>{c.push(e),n.push(new o.CustomFormFieldItem(e.code,e.title).getLayoutCol())}),e.items.forEach(e=>n.push(e.getLayoutCol())),s.FormService.createCustom({title:e.title,code:"CustomForm",primaryButton:e.btn,fields:c,layout:{rows:[{cols:n}]},onSave:null!==(i=e.onSave)&&void 0!==i?i:()=>{}})}}},686:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getAddFilePriceCommand=t.getAddPriceCommand=void 0;const o=i(913),s=i(305);t.getAddPriceCommand=function(e){return{title:o.Translation.Price.Add,code:o.Translation.Price.Add,icon:"plus",execute(t){const i=s.FormService.create(o.DbSchema.PriceList,0),c=null==t?void 0:t.list;s.Ui.showSidebar(i),i.onClose(()=>{null!=e&&e(),null!=c&&c.refresh()})}}},t.getAddFilePriceCommand=function(e){return{title:o.Translation.Price.AddViaFile,code:o.Translation.Price.AddViaFile,icon:"file-invoice-dollar",execute:t=>{const i=null==t?void 0:t.list,o=new(s.modules.get("mdt.import").ImportForm)("pl.PriceList",{onSuccessfullyCompleted:()=>{null!=e&&e(),null!=i&&i.refresh()}});s.Ui.showSidebar(o)}}}},724:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(s,c){function n(e){try{a(o.next(e))}catch(e){c(e)}}function r(e){try{a(o.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,r)}a((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.PriceListFormExtender=void 0;const s=i(913),c=i(305);t.PriceListFormExtender=class{static init(e){e.getObject().getCode()===s.DbSchema.PriceList&&(e.getFormCtrl().options.primaryButton={title:s.Translation.Price.Add,icon:"plus"}),e.getObject().getCode()===s.DbSchema.PriceListView&&e.getFormCtrl().events.layout.begin.push(t=>o(this,void 0,void 0,function*(){var i;const o=c.legacy.LayoutBuilder.find(t,e=>"CalcInfo"===(null==e?void 0:e.code)),s=new Date(e.getRecord().DateBegin);o.options.options.query.functionParams={ID_PriceList:e.valueByPath("SrcID/ID"),DateBegin:`${s.getFullYear()}-${s.getMonth()+1}-${s.getDate()}`,ID_md_Company:null!==(i=e.getRecord().ID_md_Company)&&void 0!==i?i:null}}))}}},748:function(e,t,i){var o=this&&this.__awaiter||function(e,t,i,o){return new(i||(i=Promise))(function(s,c){function n(e){try{a(o.next(e))}catch(e){c(e)}}function r(e){try{a(o.throw(e))}catch(e){c(e)}}function a(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(n,r)}a((o=o.apply(e,t||[])).next())})};Object.defineProperty(t,"__esModule",{value:!0}),t.DiscountFormExtender=void 0;const s=i(305),c=i(913),n=i(156);t.DiscountFormExtender=class{static init(e){this.isDiscountForm(e)&&(e.getFormCtrl().options.primaryButton={title:c.Translation.Discount.Add,icon:"plus"},e.getFormCtrl().events.layout.begin.push(t=>o(this,void 0,void 0,function*(){var i=new s.legacy.LayoutBuilder(t);n.discountSkuHierarchy.levels.forEach(o=>{var c=i.cols().filter(e=>{var t;return(null===(t=e.options)||void 0===t?void 0:t.field)==o.o2mField.getCode()});const n=t=>{e.setFieldOptions({[o.o2mField.getCode()]:{nullable$:()=>t}})},r=()=>{var t=e.value("ID_md_SkuHierarchySettings");return null==t||o.id!==t?(e.value(o.o2mField.getCode(),null),n(!0),!1):(n(!1),!0)};c.length>0?s.legacy.LayoutBuilder.findField(t,o.o2mField.getCode()).options.visible=r:i.addFieldAt(e=>{var t;return"DiscountAmount"==(null===(t=e.options)||void 0===t?void 0:t.field)},o.o2mField.getCode(),{title:o.Object.getTitle(),visible:r},12,!1)})})))}static isDiscountForm(e){return e.getObject().getCode()===c.DbSchema.Discount}}},832:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CommonListExtender=void 0;const o=i(913),s={merge:!1,form:!1,inline:{readonly:!0},import:!1};t.CommonListExtender=class{static init(e){const t=e.getObject().getCode();[o.DbSchema.Discount,o.DbSchema.PriceList,o.DbSchema.DiscountListView,o.DbSchema.PriceListView].includes(t)&&(t!==o.DbSchema.PriceListView&&e.setExtOptions(s),e.addTransformerForCell(e=>{if("DateEnd"!==e.col.code)return;const t=e.record[e.col.code];t&&t.toDateString()!==o.systemDateEnd.toDateString()||e.setContent([m("div","∞")])}))}}},913:(e,t)=>{var i;Object.defineProperty(t,"__esModule",{value:!0}),t.systemDateEnd=t.DbSchema=t.Translation=void 0,t.Translation={Common:{PriceList:"pl:PriceList"},Price:{DatesConflict:"pl:DatesConflict",Add:"pl:AddPrice",AddViaFile:"pl:AddPriceFile",FileInstruction:"pl:AddFileInstruct",Delist:"pl:PriceDelist",DelistDescription:"pl:PriceDelistDescription",LoadFileDescription:"pl:LoadFileDescription",Delete:"pl:PriceDelete"},Discount:{Add:"pl:AddDiscount",Deactivate:"pl:DeactivateDiscount",Delete:"pl:DeleteDiscount"},PriceListViaFile:{DateBegin:"pl:PriceListDateBegin",PriceListType:"pl:PriceListType",Currency:"pl:PriceListCurrency",Country:"pl:PriceListCountry",File:"pl:PriceListFile",LoadFileInstruction:"pl:LoadFileInstruction"}},(i=t.DbSchema||(t.DbSchema={})).PriceList="pl.PriceList",i.PriceListView="pl.vw_PriceListTotal",i.PriceFile="pl.AddPriceFile",i.Discount="pl.Discount",i.DiscountListView="pl.vw_SplitDiscounts",t.systemDateEnd=new Date(3e3,0,1)}},t={};!function i(o){var s=t[o];if(void 0!==s)return s.exports;var c=t[o]={exports:{}};return e[o].call(c.exports,c,c.exports,i),c.exports}(156)})();
//# sourceMappingURL=index.js.map